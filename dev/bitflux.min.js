!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("d3"),require("d3fc"),require("jquery")):"function"==typeof define&&define.amd?define(["d3","d3fc","jquery"],b):a.bitflux=b(a.d3,a.fc,a.$)}(this,function(a,b,c){"use strict";function d(){function c(b){b.each(function(b){var c=a.select(this),h=c.select("#tooltip");d=b.product.priceFormat,e=b.product.volumeFormat,f=b.period.timeFormat,c.classed("hidden",!b.data),h.layout({flexDirection:"row"}).selectAll(".tooltip").layout({marginRight:40,marginLeft:15}),b.data&&h.datum(b.data).call(g)})}var d,e,f,g=b.chart.tooltip().items([["T",function(a){return f(a.date)}],["O",function(a){return d(a.open)}],["H",function(a){return d(a.high)}],["L",function(a){return d(a.low)}],["C",function(a){return d(a.close)}],["V",function(a){return e(a.volume)}]]);return c}function e(a,c,d,e){var f=b.util.extent().fields("date")(d),g=b.util.extent().fields(b.util.fn.identity)(c),h=a.distance(g[0],g[1]);if(e.getTime()<f[0]||e.getTime()>f[1])return g;var i=[a.offset(e,-h/2),a.offset(e,h/2)],j=0;return i[1].getTime()>f[1].getTime()?j=-a.distance(f[1],i[1]):i[0].getTime()<f[0].getTime()&&(j=a.distance(i[0],f[0])),[a.offset(i[0],j),a.offset(i[1],j)]}function f(b,c){var d=a.min(b,function(a){return a.getTime()}),e=a.max(b,function(a){return a.getTime()}),f=c.sort(function(a,b){return a.date-b.date}),g=a.bisector(function(a){return a.date}),h=c.slice(
// Pad and clamp the bisector values to ensure extents can be calculated
Math.max(0,g.left(f,d)-1),Math.min(g.right(f,e)+1,f.length));return h}function g(a,c,d,e){arguments.length<4&&(e=1);
// Ensure the earlier data is first in the array
var f=b.util.extent().fields(b.util.fn.identity)(c),g=b.util.extent().fields(b.util.fn.identity)(d),h=a.distance(g[0],g[1]),i=e*a.distance(f[0],f[1]),j=h>i?[a.offset(g[1],-i),g[1]]:g;return j}function h(b,c){var d=a.max(b,function(a){return a.getTime()}),e=a.max(c,function(a){return a.date.getTime()});return d===e}function i(a,c){a.secondaries.style("flex",c.secondaries().charts().length),a.overlaySecondaries.style("flex",c.secondaries().charts().length);var d=parseInt(a.app.select(".head-row").style("height"),10);sa||(d+=parseInt(a.app.select(".head-row").style("padding-top"),10)+parseInt(a.app.select(".head-row").style("padding-bottom"),10)+parseInt(a.app.select(".head-row").style("margin-bottom"),10),sa=!0);var e=b.util.innerDimensions(a.app.node()).height-d;a.chartsAndOverlay.style("height",e+"px"),c.xAxis().dimensionChanged(a.xAxis),c.nav().dimensionChanged(a.navbar),c.primary().dimensionChanged(a.primary),c.secondaries().charts().forEach(function(b){b.option.dimensionChanged(a.secondaries)})}function j(){return++ta}function k(a){return c(a).width()}
// Inspired by underscore library implementation of debounce
function l(a,b,c){var d,e,f,g,h=function(){var i=(new Date).getTime()-f;b>i&&i>=0?d=setTimeout(h.bind(this),b-i):(d=null,c||(g=a.apply(this,e),e=null))};return function(){e=arguments,f=(new Date).getTime();var i=c&&!d;return d||(d=setTimeout(h.bind(this),b)),i&&(g=a.apply(this,e),e=null),g}}
// Inspired by underscore library implementation of throttle
function m(a,b,c){var d,e,f=null,g=0;c||(c={});var h=function(){g=c.leading===!1?0:(new Date).getTime(),f=null,e=a.apply(this,d),f||(d=null)};return function(){var i=(new Date).getTime();g||c.leading!==!1||(g=i);var j=b-(i-g);return d=arguments,0>=j||j>b?(f&&(clearTimeout(f),f=null),g=i,e=a.apply(this,d),f||(d=null)):f||c.trailing===!1||(f=setTimeout(h.bind(this),j)),e}}function n(b){function c(a){
// If zooming, and about to pan off screen, do nothing
return a[0]>0&&a[1]<0}function d(){l.translate([0,0]),l.scale(1)}function e(a,b,c){return Math.min(Math.max(a,b),c)}function f(b,c){var d=b;return h(j[0])>0&&(d[1]=h.invert(h(b[1])+h(j[0]))),d[0]=a.max([c[0],d[0]]),d[1]=a.min([c[1],d[1]]),d}function g(g){var p=h(j[0]),q=h(j[1]),r=[p,q-b];l.x(h).on("zoom",function(){var b=a.event.translate,g=b[0],p=c(r);g=e(g,-r[1],-r[0]),l.translate([g,0]);var q=1===l.scale(),s=1!==l.scale();if(q&&m||s&&n){var t=h.domain();p?t=j:s&&o&&(t=ua.domain.moveToLatest(i,t,j)),t=f(t,j),t[0].getTime()!==t[1].getTime()?k.zoom(t):
// Ensure the user can't zoom-in infinitely, causing the chart to fail to render
// #168, #411
d()}else d()}),g.call(l).on("dblclick.zoom",null)}var h,i,j,k=a.dispatch("zoom"),l=a.behavior.zoom(),m=!0,n=!0,o=!0;return g.allowPan=function(a){return arguments.length?(m=a,g):m},g.allowZoom=function(a){return arguments.length?(n=a,g):n},g.trackingLatest=function(a){return arguments.length?(o=a,g):o},g.scale=function(a){return arguments.length?(h=a,g):h},g.discontinuityProvider=function(a){return arguments.length?(i=a,g):i},g.dataDateExtent=function(a){return arguments.length?(j=a,g):j},a.rebind(g,k,"on"),g}function o(){function c(a,b){a.select(".plot-area").selectAll(".e, .w").classed("hidden",b)}function d(a){return a.extent()[0]-a.extent()[1]===0}function e(a,c){var d=a.selectAll("defs").data([0]).enter().append("defs");d.html('<linearGradient id="brush-gradient" x1="0" x2="0" y1="0" y2="1">               <stop offset="0%" class="brush-gradient-top" />               <stop offset="100%" class="brush-gradient-bottom" />           </linearGradient>           <mask id="brush-mask">               <rect class="mask-background"></rect>           </mask>'),a.select(".mask-background").attr({width:g,height:j}),t.domain(b.util.extent().fields("date")(c)),u.domain(b.util.extent().fields(["low","high"]).pad(q)(c)),a.select("mask").datum(c).call(E)}function f(a){var f=a.datum();D.bucketSize(Math.max(f.data.length/r,1));var h=D(f.data);t.discontinuityProvider(f.discontinuityProvider),w.discontinuityProvider(f.discontinuityProvider),e(a,h),w.domain(f.viewDomain);var i=ua.domain.filterDataInDateRange(b.util.extent().fields("date")(h),h),j=b.util.extent().fields(["low","high"]).pad(q)(i);v.xDomain(b.util.extent().fields("date")(h)).yDomain(j),z.on("brush",function(){var b=d(z);
// Hide the bar if the extent is empty
c(a,b),b||s[qa.viewChange](z.extent())}).on("brushend",function(){var b=d(z);c(a,!1),b&&s[qa.viewChange](ua.domain.centerOnDate(f.discontinuityProvider,w.domain(),f.data,z.extent()[0]))}),v.plotArea(A),a.datum({data:h}).call(v);
// Allow to zoom using mouse, but disable panning
var k=n(g).scale(w).trackingLatest(f.trackingLatest).discontinuityProvider(f.discontinuityProvider).dataDateExtent(b.util.extent().fields("date")(f.data)).allowPan(!1).on("zoom",function(a){s[qa.viewChange](a)});a.select(".plot-area").call(k)}var g,h=100,i=40,j=h-i,k=1,l=j-k,m=l,o=k+m/2,p=2,q=[0,.04],r=200,s=a.dispatch(qa.viewChange),t=b.scale.dateTime(),u=a.scale.linear(),v=b.chart.cartesian(t,u).yTicks(0).margin({bottom:i}).xOuterTickSize(0).yOuterTickSize(0),w=b.scale.dateTime(),x=b.series.area().xValue(function(a){return a.date}).y1Value(function(a){return a.close}).y0Value(function(){return u.domain()[0]}),y=b.series.line().xValue(function(a){return a.date}).yValue(function(a){return a.close}),z=a.svg.brush(),A=b.series.multi().series([x,y,z]).decorate(function(a){var b=a.enter();a.selectAll(".background, .extent").attr("height",l).attr("y",k),
// overload d3 styling for the brush handles
// as Firefox does not react properly to setting these through less file.
b.selectAll(".resize.w>rect, .resize.e>rect").attr("width",p).attr("x",-p/2),a.selectAll(".resize.w>rect, .resize.e>rect").attr("height",m).attr("y",k),b.select(".extent").attr("mask",'url("#brush-mask")');
// Adds the handles to the brush sides
var c=b.selectAll(".e, .w");c.append("circle").attr("cy",o).attr("r",7).attr("class","outer-handle"),c.append("circle").attr("cy",o).attr("r",4).attr("class","inner-handle")}).mapping(function(a){return a===z?(z.y(null).extent(w.domain()),null):this.data}),B=b.series.area().xValue(function(a){return a.date}).y1Value(function(a){return a.close}).y0Value(function(){return u.domain()[0]}).decorate(function(a){a.enter().attr("fill",'url("#brush-gradient")')}),C=b.series.line().xValue(function(a){return a.date}).yValue(function(a){return a.close}),D=b.data.sampler.largestTriangleThreeBucket().x(function(a){return t(a.date)}).y(function(a){return u(a.close)}),E=b.series.multi().series([B,C]).xScale(t).yScale(u);return a.rebind(f,s,"on"),f.dimensionChanged=function(a){g=ua.width(a.node()),w.range([0,g]),t.range([0,g]),u.range([j,0])},f}function p(a,b){var c=b/2;return[[0,0],[c,-c],[a,-c],[a,c],[c,c],[0,0]]}function q(a,b){for(var c=a.ticks.apply(a,[]),d=a.domain(),e=0;e<b.length;e++)b[e]>d[0]&&b[e]<d[1]&&c.push(b[e]);return c}function r(a){return a.reduce(function(a,b){return b.extentAccessor?a.concat(b.extentAccessor):a},[])}function s(){function c(){var a=[v,j.option,w],b=s.map(function(a){return a.option});return a.concat(b,u)}function d(){switch(B.value(o),C.value(o),w.value(o),j.valueString){case"line":case"point":j.option.yValue(o);break;case"area":j.option.yValue(o),j.option.y0Value(function(){return z.domain()[0]})}}
// Call when what to display on the chart is modified (ie series, options)
function e(a){j=a.series,o=a.yValueAccessor.option,s=a.indicators,d(),x.series(c()),A.yTickFormat(a.product.priceFormat),a.selectorsChanged=!1}function f(a){var b=j.option.width(a);u.decorate(function(a){a.classed("band",!0),a.selectAll(".vertical > line").style("stroke-width",b)})}function g(a){a.classed("band",!1).selectAll("line").style("stroke-width",null)}function h(a){"candlestick"===j.valueString||"ohlc"===j.valueString?f(a):u.decorate(g)}function i(c){var d=c.datum();d.selectorsChanged&&e(d),A.xDomain(d.viewDomain),y.discontinuityProvider(d.discontinuityProvider),u.snap(b.util.seriesPointSnapXOnly(j.option,d.visibleData)),h(d.visibleData),B(d.data),C(d.data);
// Scale y axis
// Add percentage padding either side of extreme high/lows
var f=r(x.series()),g=b.util.extent().fields(f).pad(.08)(d.visibleData);A.yDomain(g);
// Find current tick values and add close price to this list, then set it explicitly below
var i=o(d.data[d.data.length-1]),s=q(z,[i]);A.yTickValues(s).yDecorate(function(b){var c=b.selectAll(".tick").filter(function(a){return a===i}).classed("close-line",!0),d=18;c.select("path").attr("d",function(){return a.svg.area()(p(l,d))}),c.select("text").attr("transform","translate("+d/2+",1)")});var t=z.ticks.apply(z,[]);v.yTickValues(t),
// Redraw
A.plotArea(x),c.call(A);var w=n(k).scale(y).trackingLatest(d.trackingLatest).discontinuityProvider(d.discontinuityProvider).dataDateExtent(b.util.extent().fields("date")(d.data)).on("zoom",function(a){m[qa.viewChange](a)});c.select(".plot-area").call(w)}var j,k,l=60,m=a.dispatch(qa.viewChange,qa.crosshairChange),o=function(a){return a.close},s=[],t=[],u=b.tool.crosshair().xLabel("").yLabel("").on("trackingmove",function(a){a.length>0?m.crosshairChange(a[0].datum):m.crosshairChange(void 0)}).on("trackingend",function(){m.crosshairChange(void 0)});u.id=ua.uid();var v=b.annotation.gridline().xTicks(0),w=b.annotation.line().orient("horizontal").value(o).label("").decorate(function(a){a.classed("close-line",!0)});w.id=ua.uid();var x=b.series.multi().key(function(a){return a.id}).mapping(function(a){switch(a){case w:return[this.data[this.data.length-1]];case u:return t;default:return this.visibleData}}).decorate(function(a){a.enter().select(".area").attr("fill",'url("#primary-area-series-gradient")')}),y=b.scale.dateTime(),z=a.scale.linear(),A=b.chart.cartesian(y,z).xTicks(0).yOrient("right").margin({top:0,left:0,bottom:0,right:l}).decorate(function(a){a.enter().selectAll("defs").data([0]).enter().append("defs").html('<linearGradient id="primary-area-series-gradient" x1="0%" x2="0%" y1="0%" y2="100%">                       <stop offset="0%" class="primary-area-series-gradient-top" />                       <stop offset="100%" class="primary-area-series-gradient-bottom" />                   </linearGradient>')}),B=b.indicator.algorithm.movingAverage(),C=b.indicator.algorithm.bollingerBands();
// Call when the main layout is modified
return a.rebind(i,m,"on"),i.dimensionChanged=function(a){k=ua.width(a.node())-l},i}function t(){function c(a){return a.option.id}function d(b){b.each(function(b){var c=g(this,e);c.each(function(c){this.__secondaryChart__=c,c.option.on(qa.viewChange,f[qa.viewChange]),a.select(this).datum(b).call(c.option)})})}var e=[],f=a.dispatch(qa.viewChange),g=b.util.dataJoin().children(!0).selector(".secondary-container").element("svg").attr("class",function(a){return"secondary-container secondary-"+a.valueString}).key(function(a){
// Issue with elements being regenerated due to data being overwritten. See:
// https://github.com/ScottLogic/d3fc/blob/0327890d48c9de73a41d901df02bac88dc83e398/src/series/multi.js#L26-L36
return c(this.__secondaryChart__||a)});return d.charts=function(a){return arguments.length?(e=a,d):e},a.rebind(d,f,"on"),d}function u(){function c(a){var b=(e.ticks()[1]-e.ticks()[0])/1e3;b<a.seconds?f.ticks(a.d3TimeInterval.unit,a.d3TimeInterval.value):f.ticks(6)}function d(a){var b=a.datum();e.domain(b.viewDomain),e.discontinuityProvider(b.discontinuityProvider),c(b.period),a.call(f)}var e=b.scale.dateTime(),f=a.svg.axis().scale(e).orient("bottom");return d.dimensionChanged=function(a){e.range([0,ua.width(a.node())])},d}function v(){function b(a){a.each(function(b){a.select("#legend").datum(b.legend).call(e),a.select("#navbar-container").datum(b.nav).call(f),a.select("#primary-container").datum(b.primary).call(g),a.select("#secondaries-container").datum(b.secondary).call(h),a.select("#x-axis-container").datum(b.xAxis).call(i)})}var c=a.dispatch(qa.viewChange,qa.crosshairChange),e=d(),f=o().on(qa.viewChange,c[qa.viewChange]),g=s().on(qa.viewChange,c[qa.viewChange]).on(qa.crosshairChange,c[qa.crosshairChange]),h=t().on(qa.viewChange,c[qa.viewChange]),i=u();return b.legend=function(){return e},b.nav=function(){return f},b.primary=function(){return g},b.secondaries=function(){return h},b.xAxis=function(){return i},a.rebind(b,c,"on"),b}function w(a){return{displayString:a.display,option:a}}function x(a){return{displayString:a.display,option:a}}function y(){function c(a){var b=a.datum(),c=b.selectedIndex||0,i=b.config,j=e(a,[b.options]);if(i.icon){var k=j.selectAll(".icon").data([0]);k.enter().append("span"),k.attr("class","icon "+b.options[c].icon)}else j.select(".icon").remove(),j.text(function(){return i.title||b.options[c].displayString});f(j,i.careted?[0]:[]);var l=g(a,[b.options]),m=h(l,b.options),n=m.enter().on("click",d.optionChange).append("a").attr("href","#");n.append("span").attr("class","icon"),n.append("span").attr("class","name"),m.classed("selected",function(a,d){return b.selectedIndexes?b.selectedIndexes.indexOf(d)>-1:d===c}),m.selectAll(".icon").attr("class",function(a){return"icon "+a.icon}),m.selectAll(".name").text(function(a){return a.displayString})}var d=a.dispatch("optionChange"),e=b.util.dataJoin().selector("button").element("button").attr({"class":"dropdown-toggle",type:"button","data-toggle":"dropdown"}),f=b.util.dataJoin().selector(".caret").element("span").attr("class","caret"),g=b.util.dataJoin().selector("ul").element("ul").attr("class","dropdown-menu"),h=b.util.dataJoin().selector("li").element("li").key(function(a){return a.displayString});return a.rebind(c,d,"on"),c}function z(){function c(a){var c=a.datum().selectedIndex||0,f=e(a,[a.datum().options]);f.enter().append("ul");var g=f.selectAll("li").data(b.util.fn.identity);g.enter().append("li").append("a").attr("href","#").on("click",d.tabClick),g.classed("active",function(a,b){return b===c}).select("a").text(function(a){return a.displayString}),g.exit().remove()}var d=a.dispatch("tabClick"),e=b.util.dataJoin().selector("ul").element("ul");return a.rebind(c,d,"on"),c}function A(){var b=a.dispatch(qa.dataProductChange,qa.dataPeriodChange,qa.clearAllPrimaryChartIndicatorsAndSecondaryCharts),c=y().on("optionChange",b[qa.dataProductChange]),d=z().on("tabClick",b[qa.dataPeriodChange]),e=y().on("optionChange",b[qa.dataPeriodChange]),f=function(f){f.each(function(f){var g=a.select(this),h=f.products;g.select("#product-dropdown").datum({config:f.productConfig,options:h.map(w),selectedIndex:h.map(function(a){return a.id}).indexOf(f.selectedProduct.id)}).call(c);var i=f.selectedProduct.periods;g.select("#period-selector").classed("hidden",i.length<=1).datum({options:i.map(x),selectedIndex:i.indexOf(f.selectedPeriod)}).call(d),g.select("#mobile-period-selector").classed("hidden",i.length<=1).datum({config:f.mobilePeriodConfig,options:i.map(x),selectedIndex:i.indexOf(f.selectedPeriod)}).call(e),g.select("#clear-indicators").on("click",b[qa.clearAllPrimaryChartIndicatorsAndSecondaryCharts])})};return a.rebind(f,b,"on"),f}function B(){var b=a.dispatch(qa.primaryChartSeriesChange,qa.primaryChartIndicatorChange,qa.secondaryChartChange),c=y().on("optionChange",b[qa.primaryChartSeriesChange]),d=y().on("optionChange",function(a){a.isPrimary?b[qa.primaryChartIndicatorChange](a):b[qa.secondaryChartChange](a)}),e=function(b){b.each(function(b){var e=a.select(this),f=b.seriesSelector.options.map(function(a){return a.isSelected}).indexOf(!0);e.select(".series-dropdown").datum({config:b.seriesSelector.config,options:b.seriesSelector.options,selectedIndex:f}).call(c);var g=b.indicatorSelector.options,h=g.reduce(function(a,b,c){return b.isSelected?a.concat(c):a},[]);e.select(".indicator-dropdown").datum({config:b.indicatorSelector.config,options:g,selectedIndexes:h}).call(d)})};return a.rebind(e,b,"on"),e}function C(){function b(a){var b=a.datum(),d=a.selectAll("g").data([b]),e=d.enter().append("g").attr("class","reset-button").on("click",c[qa.resetToLatest]);e.append("path").attr("d","M1.5 1.5h13.438L23 20.218 14.937 38H1.5l9.406-17.782L1.5 1.5z"),e.append("rect").attr({width:5,height:28,x:26,y:6}),d.classed("hidden",b.trackingLatest)}var c=a.dispatch(qa.resetToLatest);return a.rebind(b,c,"on"),b}function D(){function b(b){b.each(function(b){var d=a.select(this),e=d.selectAll("div").data(b.selectedIndicators,function(a){return a.valueString}),f=e.enter().append("div").attr("class","edit-indicator");f.append("span").attr("class","icon bf-icon-delete").on("click",c.indicatorChange),f.append("span").attr("class","indicator-label").text(function(a){return a.displayString}),e.exit().remove()})}var c=a.dispatch(qa.indicatorChange);return a.rebind(b,c,"on"),b}function E(){var c=a.dispatch(qa.primaryChartIndicatorChange,qa.secondaryChartChange,qa.dataProductChange),d=D().on(qa.indicatorChange,c[qa.primaryChartIndicatorChange]),e=D().on(qa.indicatorChange,c[qa.secondaryChartChange]),f=y().on("optionChange",c[qa.dataProductChange]),g=b.util.dataJoin().selector(".overlay-secondary-container").element("div").attr("class","overlay-secondary-container").key(function(a){return a.displayString}),h=function(b){b.each(function(b){var c=a.select(this),h=b.products;c.select("#mobile-product-dropdown").datum({config:b.productConfig,options:h.map(w),selectedIndex:h.map(function(a){return a.id}).indexOf(b.selectedProduct.id)}).call(f),c.select("#overlay-primary-container .edit-indicator-container").datum({selectedIndicators:b.primaryIndicators}).call(d);var i=c.select("#overlay-secondaries-container"),j=g(i,b.secondaryIndicators),k=j.enter().append("div").attr("class","edit-indicator-container");k.each(function(b){a.select(this).datum({selectedIndicators:[b]}).call(e)})})};return a.rebind(h,c,"on"),h}function F(){function a(a){var c=++b;return function(d,e){b>c||a(d,e)}}var b=0;return a.invalidateCallback=function(){return b++,a},a}function G(){function b(a){var b=1e3*f;return new Date(Math.floor(a.getTime()/b)*b)}var c=function(a){return a.date},d=function(a){return Number(a.volume)},e=function(a){return Number(a.price)},f=60,g=function(f,g){var h=b(c(g)),i=e(g),j=d(g),k=a.bisector(function(a){return a.date}).left,l=f.filter(function(a){return a.date.getTime()===h.getTime()})[0];l?(l.high=Math.max(i,l.high),l.low=Math.min(i,l.low),l.close=i,l.volume+=j):f.splice(k(f,h),0,{date:h,open:i,high:i,low:i,close:i,volume:j})};return g.granularity=function(a){return arguments.length?(f=a,g):f},g.price=function(a){return arguments.length?(e=a,g):e},g.volume=function(a){return arguments.length?(d=a,g):d},g.date=function(a){return arguments.length?(c=a,g):c},g}function H(){function b(){f&&f.streamingFeed&&f.streamingFeed.close(),k=[],i.invalidateCallback()}function c(a){return a.sort(function(a,b){return a.date-b.date})}function d(){null!=f.streamingFeed&&(f.streamingFeed.on("message",function(a){h(k,a),g[qa.newTrade](k,f)}).on("error",function(a){g[qa.streamingFeedError](a,f)}).on("close",function(a){g[qa.streamingFeedClose](a,f)}),f.streamingFeed())}function e(a,e){b(),2===arguments.length&&(f=e.source,f.historicFeed.product(e.id),null!=f.streamingFeed&&f.streamingFeed.product(e.id));var l=new Date;f.historicFeed.end(l).candles(j).granularity(a),h.granularity(a),f.historicFeed(i(function(a,b){a?g[qa.historicFeedError](a,f):(k=c(b),g[qa.historicDataLoaded](k,f),d())}))}var f,g=a.dispatch(qa.newTrade,qa.historicDataLoaded,qa.historicFeedError,qa.streamingFeedError,qa.streamingFeedClose),h=G().date(function(a){return new Date(a.time)}).volume(function(a){return Number(a.size)}),i=F(),j=200,k=[];return e.candlesOfData=function(a){return arguments.length?(j=a,e):j},a.rebind(e,g,"on"),e}function I(){var c=a.dispatch(qa.notificationClose),d=b.util.dataJoin().selector("div.alert-content").element("div").attr("class","alert-content"),e=b.util.dataJoin().selector("div.alert").element("div").attr({"class":"alert alert-info alert-dismissible",role:"alert"}).key(function(a){return a.id}),f=function(b){b.each(function(b){var f=a.select(this),g=d(f,[b]);g.enter().html('<div class="messages"></div>');var h=e(g.select(".messages"),b.messages),i=h.enter();i.html('<button type="button" class="close" aria-label="Close">                     <span aria-hidden="true">&times;</span>                 </button>                 <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>                 <span class="sr-only">Error:</span>                 <span class="message"></span>'),i.select(".close").on("click",function(a){c[qa.notificationClose](a.id)}),h.select(".message").text(function(a){return a.message})})};return a.rebind(f,c,"on"),f}function J(a){return{id:ua.uid(),message:a}}function K(b,c,d,e){return{display:b||"1 day",seconds:c||86400,d3TimeInterval:d||{unit:a.time.day,value:1},timeFormat:a.time.format(e||"%b %d")}}function L(b,c,d,e,f,g){return{id:b,display:c||"Unspecified Product",priceFormat:a.format(g||".2f"),volumeFormat:a.format(f||".2f"),periods:d||[],source:e}}function M(a,b,c,d,e){return{historicFeed:a,historicNotificationFormatter:b,streamingFeed:c,streamingNotificationFormatter:d,discontinuityProvider:e}}function N(a){var b;if(a.wasClean===!1&&1e3!==a.code&&1006!==a.code){var c=a.reason||"Unkown reason.";b="Disconnected from live stream: "+a.code+" "+c}return b}function O(a){var b;
// The WebSocket's error event doesn't contain much useful information,
// so the close event is used to report errors instead
return"error"===a.type&&a.message?b="Live stream error: "+a.message:"close"===a.type&&(b=N(a)),b}function P(a,b,c,d){return{title:a||null,careted:b||!1,listIcons:c||!1,icon:d||!1}}function Q(a,b,c){return{productConfig:P(null,!0),mobilePeriodConfig:P(),products:a,selectedProduct:b,selectedPeriod:c,alertMessages:[],primaryIndicators:[],secondaryIndicators:[]}}function R(a,b){return{primaryIndicators:[],secondaryIndicators:[],productConfig:P(),products:a,selectedProduct:b}}function S(a,b,c,d,e){return{displayString:a,// TODO: is 'displayName' better?
valueString:b,// TODO: is this an id?
option:c,// TODO: Ideally, remove.
isSelected:!1,icon:d,isPrimary:e}}function T(a,b){return{config:a,options:b}}function U(a,b,c,d,e){return{legend:a,nav:b,primary:c,secondary:d,xAxis:e}}function V(a,b){return{data:void 0,product:a,period:b}}function W(a){return{data:[],viewDomain:[],trackingLatest:!0,discontinuityProvider:a}}function X(){return{trackingLatest:!0}}function Y(){var c=b.scale.dateTime(),d=a.scale.linear(),e=b.util.fractionalBarWidth(.75),f=function(a){return a.date},g=function(a,b){return c(f(a,b))},h=function(a){return a.low},i=function(a){return a.high},j=function(a){return a.close},k=b.svg.candlestick().x(function(a){return c(a.date)}).open(function(a){return d(a.open)}).high(function(a){return d(i(a))}).low(function(a){return d(h(a))}).close(function(a){return d(a.close)}),l=b.util.dataJoin().selector("path.up").element("path").attr("class","up"),m=b.util.dataJoin().selector("path.down").element("path").attr("class","down"),n=function(a){a.each(function(a){k.width(e(a.map(g)));var b=a.filter(function(a){return a.open<a.close}),c=a.filter(function(a){return a.open>=a.close});l(this,[b]).attr("d",k),m(this,[c]).attr("d",k)})};return n.xScale=function(a){return arguments.length?(c=a,n):c},n.yScale=function(a){return arguments.length?(d=a,n):d},n.xValue=function(a){return arguments.length?(f=a,n):f},n.yLowValue=function(a){return arguments.length?(h=a,n):h},n.yHighValue=function(a){return arguments.length?(i=a,n):i},n.yCloseValue=function(a){return arguments.length?(j=a,n):j},n.width=function(a){return e(a.map(g))},n}function Z(a,b){var c={data:[],visibleData:[],trackingLatest:!0,viewDomain:[],selectorsChanged:!0,discontinuityProvider:b},d=a;Object.defineProperty(c,"product",{get:function(){return d},set:function(a){d=a,c.selectorsChanged=!0}});var e=Y();e.id=ua.uid();var f=S("Candlestick","candlestick",e);f.option.extentAccessor=["high","low"],Object.defineProperty(c,"series",{get:function(){return f},set:function(a){f=a,c.selectorsChanged=!0}});var g={option:function(a){return a.close}};Object.defineProperty(c,"yValueAccessor",{get:function(){return g},set:function(a){g=a,c.selectorsChanged=!0}});var h=[];return Object.defineProperty(c,"indicators",{get:function(){return h},set:function(a){h=a,c.selectorsChanged=!0}}),c}function $(a,b){return{data:[],visibleData:[],viewDomain:[],trackingLatest:!0,product:a,discontinuityProvider:b,indicators:[]}}function _(a,b){return{viewDomain:[],period:a,discontinuityProvider:b}}function aa(){return{messages:[]}}function ba(){function c(c){c.each(function(c){f.discontinuityProvider(c.discontinuityProvider);var g=a.select(this).datum(c.visibleData).call(k),i=n(d).scale(f).trackingLatest(h).discontinuityProvider(c.discontinuityProvider).dataDateExtent(b.util.extent().fields("date")(c.data)).on("zoom",function(a){e[qa.viewChange](a)});g.select(".plot-area-container").call(i)})}var d,e=a.dispatch(qa.viewChange),f=b.scale.dateTime(),g=a.scale.linear(),h=!0,i=60,j=b.series.multi(),k=b.chart.cartesian(f,g).plotArea(j).xTicks(0).yOrient("right").margin({top:0,left:0,bottom:0,right:i});return c.trackingLatest=function(a){return arguments.length?(h=a,c):h},a.rebind(c,e,"on"),a.rebind(c,j,"series","mapping","decorate"),a.rebind(c,k,"yTickValues","yTickFormat","yTicks","xDomain","yDomain"),c.dimensionChanged=function(a){d=ua.width(a.node())-i},c}function ca(){function c(a){var c=a.datum();g(c.data);var d=b.util.extent().fields("macd").symmetricalAbout(0).pad(.08)(c.data.map(function(a){return a.macd}));h.trackingLatest(c.trackingLatest).xDomain(c.viewDomain).yDomain(d),a.call(h)}var d=a.dispatch(qa.viewChange),e=b.annotation.line().value(0).label(""),f=b.indicator.renderer.macd(),g=b.indicator.algorithm.macd(),h=ba().series([e,f]).yTicks(5).mapping(function(a){return a===e?[0]:this}).decorate(function(a){a.enter().attr("class",function(a,b){return["multi zero","multi"][b]})}).on(qa.viewChange,function(a){d[qa.viewChange](a)});return a.rebind(c,d,"on"),c.dimensionChanged=function(a){h.dimensionChanged(a)},c}function da(){function c(a){var b=a.datum();f(b.data),h.trackingLatest(b.trackingLatest).xDomain(b.viewDomain).yDomain([0,100]),a.call(h)}var d=a.dispatch(qa.viewChange),e=b.indicator.renderer.relativeStrengthIndex(),f=b.indicator.algorithm.relativeStrengthIndex(),g=[e.lowerValue(),50,e.upperValue()],h=ba().series([e]).yTickValues(g).on(qa.viewChange,function(a){d[qa.viewChange](a)});return a.rebind(c,d,"on"),c.dimensionChanged=function(a){h.dimensionChanged(a)},c}function ea(){function c(a){a.each(function(c){var d=b.util.extent().fields("volume").pad(.08)(c.data);d[0]<0&&(d[0]=0),f.yTickFormat(c.product.volumeFormat).trackingLatest(c.trackingLatest).xDomain(c.viewDomain).yDomain(d),a.call(f)})}var d=a.dispatch(qa.viewChange),e=b.series.bar().xValue(function(a){return a.date}).yValue(function(a){return a.volume}),f=ba().series([e]).yTicks(4).on(qa.viewChange,function(a){d[qa.viewChange](a)});return a.rebind(c,d,"on"),c.dimensionChanged=function(a){f.dimensionChanged(a)},c}function fa(){var a,c,d,e=b.data.random.financial(),f=[86400],g=null,h=function(b){c.setHours(0,0,0,0);var d=864e5;e.startDate(new Date(c-(a-1)*d));var f=e(a);b(null,f)};return h.candles=function(b){return arguments.length?(a=b,h):a},h.end=function(a){return arguments.length?(c=a,h):c},h.granularity=function(a){if(!arguments.length)return d;if(-1===f.indexOf(a))throw new Error("Granularity of "+a+" is not supported. Random Financial Data Generator only supports daily data.");return d=a,h},h.product=function(a){if(!arguments.length)return g;if("Data Generator"!==a)throw new Error("Random Financial Data Generator does not support products.");return g=a,h},h.apiKey=function(){throw new Error("Not implemented.")},h}function ga(){var c,d=1e3,e=b.data.feed.coinbase(),f=l(function(b){var d=a.time.second.offset(e.end(),-c*e.granularity());e.start(d),e(b)},d);return f.candles=function(a){return arguments.length?(c=a,f):c},f.apiKey=function(){throw new Error("Not implemented.")},a.rebind(f,e,"end","granularity","product"),f}function ha(a){var b;return a&&(b=a.message),b}
// https://docs.exchange.coinbase.com/#websocket-feed
function ia(){var b,c="BTC-USD",d=a.dispatch("open","close","error","message"),e="match",f=function(a,f){a=a||"wss://ws-feed.exchange.coinbase.com",f=f||{type:"subscribe",product_id:c},b=new WebSocket(a),b.onopen=function(a){b.send(JSON.stringify(f)),d.open(a)},b.onerror=function(a){d.error(a)},b.onclose=function(a){d.close(a)},b.onmessage=function(a){var b=JSON.parse(a.data);b.type===e?d.message(b):"error"===b.type&&d.error(b)}};return a.rebind(f,d,"on"),f.close=function(){
// Only close the WebSocket if it is opening or open
!b||b.readyState!==WebSocket.CONNECTING&&b.readyState!==WebSocket.OPEN||b.close()},f.messageType=function(a){return arguments.length?(e=a,f):e},f.product=function(a){return arguments.length?(c=a,f):c},f}function ja(){function c(a){var b=j.get(a);return b||(b=a[0].toLowerCase()+a.substr(1)),b}function d(a){return a.map(function(a){return a.date.setHours(0,0,0,0),a})}function e(b){var c=a.time.second.offset(h.end(),-g*f);h.start(c).collapse(i.get(f)),h(function(a,c){var e=d(c);b(a,e)})}var f,g,h=b.data.feed.quandl().database("WIKI").columnNameMap(c),i=a.map();i.set(86400,"daily"),i.set(604800,"weekly");
// Map fields for WIKI database, to use all adjusted values
var j=a.map();return j.set("Open","unadjustedOpen"),j.set("High","unadjustedHigh"),j.set("Low","unadjustedLow"),j.set("Close","unadjustedClose"),j.set("Volume","unadjustedVolume"),j.set("Adj. Open","open"),j.set("Adj. High","high"),j.set("Adj. Low","low"),j.set("Adj. Close","close"),j.set("Adj. Volume","volume"),e.candles=function(a){return arguments.length?(g=a,e):g},e.granularity=function(a){if(!arguments.length)return f;if(!i.has(a))throw new Error("Granularity of "+a+" is not supported.");return f=a,e},b.util.rebind(e,h,{end:"end",product:"dataset",apiKey:"apiKey"}),e}function ka(a){var b;return a&&a.quandl_error&&(b=a.quandl_error.message),b}
// TODO: Temp until merged into d3fc
function la(){function b(a){return 0===a.getDay()||6===a.getDay()}var c=864e5,d=5*c,e=7*c,f={};
// returns the number of included milliseconds (i.e. those which do not fall)
// within discontinuities, along this scale
return f.clampDown=function(c){if(c&&b(c)){var d=0===c.getDay()?2:1,e=a.time.day.ceil(c);
// then subtract the required number of days
return a.time.day.offset(e,-d)}return c},f.clampUp=function(c){if(c&&b(c)){var d=0===c.getDay()?1:2,e=a.time.day.floor(c);
// then add the required number of days
return a.time.day.offset(e,d)}return c},f.distance=function(b,c){b=f.clampUp(b),c=f.clampDown(c);
// move the start date to the end of week boundary
var g=a.time.saturday.ceil(b);if(g>c)return c.getTime()-b.getTime();var h=g.getTime()-b.getTime(),i=a.time.saturday.ceil(c),j=i.getTime()-c.getTime(),k=Math.round((i.getTime()-g.getTime())/e);return k*d+h-j},f.offset=function(c,e){var g=b(c)?f.clampUp(c):c,h=e;if(0>h){var i=a.time.monday.floor(g);if(h-=i.getTime()-g.getTime(),h>=0)return new Date(g.getTime()+e);g=a.time.day.offset(i,-2);var j=Math.floor(h/d);return g=a.time.day.offset(g,7*j),h-=j*d,g=new Date(g.getTime()+h),g=a.time.day.offset(g,2)}
// move to the end of week boundary
var k=a.time.saturday.ceil(g);
// if the distance to the boundary is greater than the number of ms
// simply add the ms to the current date
if(h-=k.getTime()-g.getTime(),0>h)return new Date(g.getTime()+e);
// skip the weekend
g=a.time.day.offset(k,2);
// add all of the complete weeks to the date
var l=Math.floor(h/d);
// add the remaining time
return g=a.time.day.offset(g,7*l),h-=l*d,g=new Date(g.getTime()+h)},f.copy=function(){return f},f}function ma(){function c(){return{week1:Ba.data.period("Weekly",604800,{unit:a.time.week,value:1},"%b %d"),day1:Ba.data.period("Daily",86400,{unit:a.time.day,value:1},"%b %d"),hour1:Ba.data.period("1 Hr",3600,{unit:a.time.hour,value:1},"%b %d %Hh"),minute5:Ba.data.period("5 Min",300,{unit:a.time.minute,value:5},"%H:%M"),minute1:Ba.data.period("1 Min",60,{unit:a.time.minute,value:1},"%H:%M")}}function d(){return{generated:Ba.data.source(fa(),null,null,null,b.scale.discontinuity.identity()),bitcoin:Ba.data.source(ga(),ha,ia(),O,b.scale.discontinuity.identity()),quandl:Ba.data.source(ja(),ka,null,null,la())}}function e(){return{generated:Ba.data.product("Data Generator","Data Generator",[k.day1],l.generated,".3s"),quandl:Ba.data.product("GOOG","GOOG",[k.day1],l.quandl,".3s")}}function f(){var a=Y();a.id=ua.uid();var c=Ba.menu.option("Candlestick","candlestick",a,"bf-icon-candlestick-series");c.isSelected=!0,c.option.extentAccessor=["high","low"];var d=b.series.ohlc();d.id=ua.uid();var e=Ba.menu.option("OHLC","ohlc",d,"bf-icon-ohlc-series");e.option.extentAccessor=["high","low"];var f=b.series.line().xValue(function(a){return a.date});f.id=ua.uid();var g=Ba.menu.option("Line","line",f,"bf-icon-line-series");g.option.extentAccessor="close";var h=b.series.point().xValue(function(a){return a.date});h.id=ua.uid();var i=Ba.menu.option("Point","point",h,"bf-icon-point-series");i.option.extentAccessor="close";var j=b.series.area().xValue(function(a){return a.date});j.id=ua.uid();var k=Ba.menu.option("Area","area",j,"bf-icon-area-series");k.option.extentAccessor="close";var l=Ba.menu.dropdownConfig(null,!1,!0,!0),m=[c,e,g,i,k];return Ba.menu.selector(l,m)}function g(){var a=Da.secondary,c=b.series.line().decorate(function(a){a.enter().classed("movingAverage",!0)}).xValue(function(a){return a.date}).yValue(function(a){return a.movingAverage});c.id=ua.uid();var d=Ba.menu.option("Moving Average","movingAverage",c,"bf-icon-moving-average-indicator",!0);d.option.extentAccessor=function(a){return a.movingAverage};var e=b.indicator.renderer.bollingerBands();e.id=ua.uid();var f=Ba.menu.option("Bollinger Bands","bollinger",e,"bf-icon-bollinger-bands-indicator",!0);f.option.extentAccessor=[function(a){return a.bollingerBands.lower},function(a){return a.bollingerBands.upper}];var g=a.rsi();g.id=ua.uid();var h=a.macd();h.id=ua.uid();var i=a.volume();i.id=ua.uid();var j=[d,f,Ba.menu.option("Relative Strength Index","rsi",g,"bf-icon-rsi-indicator",!1),Ba.menu.option("MACD","macd",h,"bf-icon-macd-indicator",!1),Ba.menu.option("Volume","volume",i,"bf-icon-bar-series",!1)];return j}function h(){var a=Ba.menu.dropdownConfig("Add Indicator",!1,!0);return Ba.menu.selector(a,g())}function i(){return{seriesSelector:f(),indicatorSelector:h()}}function j(){var a=Ba.chart.legend(m.generated,k.day1),b=Ba.chart.nav(m.generated.source.discontinuityProvider),c=Ba.chart.primary(m.generated,m.generated.source.discontinuityProvider),d=Ba.chart.secondary(m.generated,m.generated.source.discontinuityProvider),e=Ba.chart.xAxis(k.day1,m.generated.source.discontinuityProvider);return Ba.chart.group(a,b,c,d,e)}var k=c(),l=d(),m=e();return{data:[],periods:k,sources:l,selectors:i(),navReset:Ba.chart.navigationReset(),headMenu:Ba.menu.head([m.generated,m.quandl],m.generated,k.day1),overlay:Ba.menu.overlay([m.generated,m.quandl],m.generated),notificationMessages:Ba.notification.messages(),charts:j()}}function na(b){a.json("https://api.exchange.coinbase.com/products",function(a,c){return a?void b(a):void b(a,c)})}function oa(a,b,c,d){return a.map(function(a){return Ba.data.product(a.id,a.id,d.get(a.id)||c,b)})}function pa(){function c(){Y&&(Y=!1),$&&I.suspendLayout(!1),I.chartsAndOverlay.datum(T.charts).call(V),I.app.select("#navbar-reset").datum(T.navReset).call(N),I.app.select(".head-menu").datum(T.headMenu).call(M),I.app.selectAll(".selectors").datum(T.selectors).call(P),I.app.select("#notifications").datum(T.notificationMessages).call(Q),I.overlay.datum(T.overlay).call(L),$&&(I.suspendLayout(!0),$=!1)}function d(){$=!0,ua.layout(I,V)}function e(){a.select(window).on("resize",function(){d(),Z()})}function f(a){T.notificationMessages.messages.unshift(J(a))}function g(a){var b=[a[0],a[1]];T.charts.primary.viewDomain=b,T.charts.secondary.viewDomain=b,T.charts.xAxis.viewDomain=b,T.charts.nav.viewDomain=b;var c=ua.domain.filterDataInDateRange(b,T.data);T.charts.primary.visibleData=c,T.charts.secondary.visibleData=c;var d=ua.domain.trackingLatestData(T.charts.primary.viewDomain,T.charts.primary.data);T.charts.primary.trackingLatest=d,T.charts.secondary.trackingLatest=d,T.charts.nav.trackingLatest=d,T.navReset.trackingLatest=d,Z()}function h(a){a.isSelected=!a.isSelected,A(),Z()}function i(a){a.isSelected=!a.isSelected,C(),Z()}function j(a){T.charts.legend.data=a,Z()}function k(a,b){var c;c=b.streamingNotificationFormatter?b.streamingNotificationFormatter(a):O(a),c&&(f(c),Z())}function l(){var a=T.charts.primary.data,c=b.util.extent().fields("date")(a),d=ua.domain.moveToLatest(T.charts.primary.discontinuityProvider,c,c,X);g(d)}function m(a,b){var c='<div class="spinner"></div>',d=arguments.length>1||a,e="";b&&b.length&&(e='<div class="content alert alert-info">'+b+"</div>"),I.app.select("#loading-status-message").classed("hidden",!d).html(b?e:c)}function n(a){T.data=a,T.charts.primary.data=a,T.charts.secondary.data=a,T.charts.nav.data=a}function o(a){var b=a.discontinuityProvider;T.charts.xAxis.discontinuityProvider=b,T.charts.nav.discontinuityProvider=b,T.charts.primary.discontinuityProvider=b,T.charts.secondary.discontinuityProvider=b}function p(a){T.headMenu.selectedProduct=a,T.overlay.selectedProduct=a,T.charts.primary.product=a,T.charts.secondary.product=a,T.charts.legend.product=a,o(a.source)}function q(a){T.headMenu.selectedPeriod=a,T.charts.xAxis.period=a,T.charts.legend.period=a}function r(a){m(!0),p(a),q(a.periods[0]),U(a.periods[0].seconds,a)}function s(){return v().on(qa.crosshairChange,j).on(qa.viewChange,g)}function t(){return va.navigationReset().on(qa.resetToLatest,l)}function u(){return H().on(qa.newTrade,function(a){if(n(a),T.charts.primary.trackingLatest){var c=ua.domain.moveToLatest(T.charts.primary.discontinuityProvider,T.charts.primary.viewDomain,b.util.extent().fields("date")(T.charts.primary.data));g(c)}}).on(qa.historicDataLoaded,function(a){m(!1),n(a),T.charts.legend.data=null,l(),d()}).on(qa.historicFeedError,function(a,b){if(K){var c=K(a)||!0;m(!1,c)}else{m(!1,"Error loading data. Please make your selection again, or refresh the page.");var d="";try{var e=JSON.parse(a.responseText),g=b.historicNotificationFormatter(e);g&&(d=". "+g)}catch(h){d=""}var i=a.statusText||"Unknown reason.",j="Error getting historic data: "+i+d;f(j)}Z()}).on(qa.streamingFeedError,k).on(qa.streamingFeedClose,k)}function w(){return va.head().on(qa.dataProductChange,function(a){r(a.option),Z()}).on(qa.dataPeriodChange,function(a){m(!0),q(a.option),U(a.option.seconds),Z()}).on(qa.clearAllPrimaryChartIndicatorsAndSecondaryCharts,function(){T.charts.primary.indicators.forEach(y),T.charts.secondary.indicators.forEach(y),A(),C(),Z()})}function x(a,b){b.forEach(function(a){a.isSelected=!1}),a.isSelected=!0}function y(a){a.isSelected=!1}function z(){return va.selectors().on(qa.primaryChartSeriesChange,function(a){T.charts.primary.series=a,x(a,T.selectors.seriesSelector.options),Z()}).on(qa.primaryChartIndicatorChange,h).on(qa.secondaryChartChange,i)}function A(){T.charts.primary.indicators=T.selectors.indicatorSelector.options.filter(function(a){return a.isSelected&&a.isPrimary}),T.overlay.primaryIndicators=T.charts.primary.indicators,T.headMenu.primaryIndicators=T.charts.primary.indicators}function B(){T.charts.secondary.indicators=T.selectors.indicatorSelector.options.filter(function(a){return a.isSelected&&!a.isPrimary}),V.secondaries().charts(T.charts.secondary.indicators.map(function(a){return a})),T.overlay.secondaryIndicators=T.charts.secondary.indicators,T.headMenu.secondaryIndicators=T.charts.secondary.indicators}function C(){B(),d()}function D(){return va.overlay().on(qa.primaryChartIndicatorChange,h).on(qa.secondaryChartChange,i).on(qa.dataProductChange,function(a){r(a.option),Z()})}function E(a){T.notificationMessages.messages=T.notificationMessages.messages.filter(function(b){return b.id!==a}),Z()}function F(){return wa.toast().on(qa.notificationClose,E)}function G(b,c){if(b){var d=b.statusText||"Unknown reason.",e="Error retrieving Coinbase products: "+d;T.notificationMessages.messages.unshift(J(e))}else{var f=[T.periods.hour1,T.periods.day1],g=a.map();g.set("BTC-USD",[T.periods.minute1,T.periods.minute5,T.periods.hour1,T.periods.day1]);var h=oa(c,T.sources.bitcoin,f,g);T.headMenu.products=T.headMenu.products.concat(h),T.overlay.products=T.headMenu.products}Z()}var I,K,L,M,N,P,Q,R='<div class="container-fluid">         <div id="notifications"></div>         <div id="loading-status-message"></div>         <div class="row head-menu head-row">             <div class="col-md-12 head-sub-row">                 <div id="product-dropdown" class="dropdown product-dropdown"></div>                 <div class="selectors">                     <div class="series-dropdown dropdown selector-dropdown"></div>                     <div class="indicator-dropdown dropdown selector-dropdown"></div>                     <div id="mobile-period-selector" class="dropdown"></div>                 </div>                 <div id="period-selector"></div>                 <span id="clear-indicators" class="icon bf-icon-delete delete-button"></span>             </div>         </div>         <div class="row primary-row">             <div id="charts" class="col-md-12">                 <div id="charts-container">                     <svg id="primary-container"></svg>                     <div id="secondaries-container"></div>                     <div class="x-axis-row">                         <svg id="x-axis-container"></svg>                     </div>                     <div id="navbar-row">                         <svg id="navbar-container"></svg>                         <svg id="navbar-reset"></svg>                     </div>                 </div>                 <div id="overlay">                     <div id="overlay-primary-container">                         <div id="overlay-primary-head">                             <div class="selectors">                                 <div id="mobile-product-dropdown" class="dropdown"></div>                                 <div class="series-dropdown dropdown selector-dropdown"></div>                                 <div class="indicator-dropdown dropdown selector-dropdown"></div>                             </div>                             <div id="legend">                                 <svg id="tooltip"></svg>                             </div>                         </div>                         <div id="overlay-primary-bottom">                             <div class="edit-indicator-container"></div>                         </div>                     </div>                     <div id="overlay-secondaries-container"></div>                     <div class="x-axis-row"></div>                     <div id="overlay-navbar-row"></div>                 </div>             </div>         </div>     </div>',S={},T=ma(),U=u(),V=s(),W=!1,X=.2,Y=!0,Z=b.util.render(c),$=!0;return S.fetchCoinbaseProducts=function(a){return arguments.length?(W=a,S):W},S.changeQuandlProduct=function(a){var b=xa.product(a,a,[T.periods.day1],T.sources.quandl,".3s"),c=T.headMenu.products.some(function(a){return a.id===b.id}),d=T.overlay.products.some(function(a){return a.id===b.id});c||T.headMenu.products.push(b),d||T.overlay.products.push(b),r(b),Y||Z()},S.proportionOfDataToDisplayByDefault=function(a){return arguments.length?(X=a,S):X},S.historicFeedErrorCallback=function(a){return arguments.length?(K=a,S):K},S.indicators=function(a){if(!arguments.length){var b=[];return T.selectors.indicatorSelector.options.forEach(function(a){a.isSelected&&b.push(a.valueString)}),b}return T.selectors.indicatorSelector.options.forEach(function(b){b.isSelected=a.some(function(a){return a===b.valueString})}),A(),Y?B():(C(),Z()),S},S.run=function(b){if(!b)throw new Error("An element must be specified when running the application.");var c=a.select(b);c.html(R);var f=c.select("#charts"),g=c.select("#charts-container"),h=c.select("#overlay");I={app:c,charts:g,chartsAndOverlay:f,primary:g.select("#primary-container"),secondaries:g.select("#secondaries-container"),xAxis:g.select("#x-axis-container"),navbar:g.select("#navbar-container"),overlay:h,overlaySecondaries:h.select("#overlay-secondaries-container"),legend:c.select("#legend"),suspendLayout:function(a){var b=this;Object.keys(b).forEach(function(c){"function"!=typeof b[c]&&b[c].layoutSuspended(a)})}},M=w(),N=t(),P=z(),L=D(),Q=F(),d(),e(),U(T.headMenu.selectedPeriod.seconds,T.headMenu.selectedProduct),W?na(G):T.sources.bitcoin&&delete T.sources.bitcoin},b.util.rebind(S,T.sources.quandl.historicFeed,{quandlApiKey:"apiKey"}),b.util.rebind(S,U,{periodsOfDataToFetch:"candlesOfData"}),S}a="default"in a?a["default"]:a,b="default"in b?b["default"]:b,c="default"in c?c["default"]:c;var qa={crosshairChange:"crosshairChange",viewChange:"viewChange",newTrade:"newTrade",historicDataLoaded:"historicDataLoaded",historicFeedError:"historicFeedError",streamingFeedError:"streamingFeedError",streamingFeedClose:"streamingFeedClose",dataProductChange:"dataProductChange",dataPeriodChange:"dataPeriodChange",resetToLatest:"resetToLatest",clearAllPrimaryChartIndicatorsAndSecondaryCharts:"clearAllPrimaryChartIndicatorsAndSecondaryCharts",primaryChartSeriesChange:"primaryChartSeriesChange",primaryChartYValueAccessorChange:"primaryChartYValueAccessorChange",primaryChartIndicatorChange:"primaryChartIndicatorChange",secondaryChartChange:"secondaryChartChange",indicatorChange:"indicatorChange",notificationClose:"notificationClose"},ra={centerOnDate:e,filterDataInDateRange:f,moveToLatest:g,trackingLatestData:h},sa=!1,ta=0,ua={domain:ra,layout:i,uid:j,width:k,debounce:l,throttle:m},va={head:A,selectors:B,navigationReset:C,overlay:E},wa={toast:I},xa={period:K,product:L,source:M},ya={head:Q,periodAdaptor:x,productAdaptor:w,overlay:R,dropdownConfig:P,option:S,selector:T},za={group:U,legend:V,nav:W,navigationReset:X,primary:Z,secondary:$,xAxis:_},Aa={message:J,messages:aa},Ba={menu:ya,chart:za,data:xa,notification:Aa},Ca={base:ba,macd:ca,rsi:da,volume:ea},Da={legend:d,nav:o,primary:s,xAxis:u,secondary:Ca,multiChart:t,group:v},Ea={app:pa};return Ea});